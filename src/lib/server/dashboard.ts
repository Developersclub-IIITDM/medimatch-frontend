import { cookies } from \"next/headers\";\nimport { db } from \"@/db\";\nimport { Users, Sessions, Appointments, Patient_details } from \"@/db/schema\";\nimport { eq, and, gte, lt } from \"drizzle-orm\";\n\nexport async function getCurrentUser() {\n  const sessionId = (await cookies()).get(\"session\")?.value;\n  \n  if (!sessionId) {\n    return null;\n  }\n  \n  const result = await db\n    .select({\n      user_id: Users.user_id,\n      name: Users.name,\n      email: Users.email,\n      role: Users.role,\n    })\n    .from(Sessions)\n    .innerJoin(Users, eq(Sessions.user_id, Users.user_id))\n    .where(and(\n      eq(Sessions.session_id, sessionId),\n      gte(Sessions.expires_at, new Date())\n    ))\n    .limit(1);\n    \n  return result[0] || null;\n}\n\nexport async function getTodaysAppointments(doctorId: number) {\n  const today = new Date();\n  const startOfDay = new Date(today.getFullYear(), today.getMonth(), today.getDate());\n  const endOfDay = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1);\n  \n  const appointments = await db\n    .select({\n      id: Appointments.id,\n      appointment_time: Appointments.appointment_time,\n      status: Appointments.status,\n      patient: {\n        full_name: Patient_details.full_name,\n        phone: Patient_details.phone,\n        age: Patient_details.age,\n        gender: Patient_details.gender,\n        picture: Users.picture,\n      }\n    })\n    .from(Appointments)\n    .innerJoin(Patient_details, eq(Appointments.user_id, Patient_details.user_id))\n    .innerJoin(Users, eq(Appointments.user_id, Users.user_id))\n    .where(and(\n      eq(Appointments.doctor_id, doctorId),\n      gte(Appointments.appointment_time, startOfDay),\n      lt(Appointments.appointment_time, endOfDay)\n    ))\n    .orderBy(Appointments.appointment_time);\n    \n  return appointments;\n}